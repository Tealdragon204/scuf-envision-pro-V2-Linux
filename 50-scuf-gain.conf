# SCUF Envision Pro V2 â€” Gain boost for quiet headphone output
#
# The SCUF's hardware mixer maxes out at -16 dB, making audio much
# quieter than expected even at 100% software volume. This WirePlumber
# component applies a flat +12 dB gain boost via a smart filter that
# transparently inserts between audio streams and the SCUF sink.
#
# This MUST be loaded as a WirePlumber component (not a PipeWire
# context.modules entry) so that WirePlumber's smart filter policy
# manages the lifecycle and auto-linking.
#
# Adjust the "Gain" value below if audio is too loud or too quiet:
#   +6 dB  = ~2x louder    (conservative)
#   +12 dB = ~4x louder    (recommended default)
#   +16 dB = ~6x louder    (fully compensates hardware -16 dB deficit)
#   +18 dB = ~8x louder    (risk of clipping on loud content)
#
# Install: sudo cp 50-scuf-gain.conf /etc/wireplumber/wireplumber.conf.d/
#          (same directory as 50-scuf-audio.conf)
# Then restart PipeWire/WirePlumber or reboot.

wireplumber.profiles = {
  main = {
    filter.sink.scuf-gain = required
  }
}

wireplumber.components = [
  {
    name = libpipewire-module-filter-chain, type = pw-module
    arguments = {
      node.name        = "filter.sink.scuf-gain"
      node.description = "SCUF Gain Boost"
      media.name       = "SCUF Gain Boost"
      filter.graph = {
        nodes = [
          {
            type    = builtin
            name    = gain
            label   = bq_highshelf
            control = { "Freq" = 0.0, "Q" = 1.0, "Gain" = 12.0 }
          }
        ]
      }
      audio.channels = 2
      audio.position = [ FL, FR ]
      capture.props = {
        media.class         = Audio/Sink
        filter.smart        = true
        filter.smart.name   = "filter.sink.scuf-gain"
        filter.smart.target = {
          node.name = "~alsa_output.usb-Scuf_Gaming_SCUF_Envision_Pro*"
        }
      }
      playback.props = {
        node.passive = true
        media.role   = "DSP"
      }
    }
    provides = filter.sink.scuf-gain
  }
]
