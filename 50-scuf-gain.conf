# SCUF Envision Pro V2 â€” Gain boost for quiet headphone output
#
# The SCUF's hardware mixer maxes out at -16 dB, making audio much
# quieter than expected even at 100% software volume. This filter chain
# applies a flat +12 dB gain boost via PipeWire DSP to compensate.
#
# The smart filter automatically inserts this gain stage whenever audio
# is routed to the SCUF headphone output. Other audio devices are
# unaffected.
#
# Adjust the "gain" value below if audio is too loud or too quiet:
#   +6 dB  = ~2x louder    (conservative)
#   +12 dB = ~4x louder    (recommended default)
#   +16 dB = ~6x louder    (fully compensates hardware -16 dB deficit)
#   +18 dB = ~8x louder    (risk of clipping on loud content)
#
# Install: sudo cp 50-scuf-gain.conf /etc/pipewire/pipewire.conf.d/
# Then restart PipeWire or reboot.
#
# Troubleshooting: If the filter loads but doesn't attach, check:
#   1. pw-dump | grep -A5 scuf_gain  (verify filter nodes exist)
#   2. wpctl status                   (look for "SCUF Gain Boost" under Filters)
#   3. The smart-filter WirePlumber policy must be enabled (default on most distros)

context.modules = [
  {
    name = libpipewire-module-filter-chain
    args = {
      node.description = "SCUF Gain Boost"
      media.name = "SCUF Gain Boost"
      # Smart filter properties at args level so they become global node
      # properties visible to WirePlumber's smart-filter policy.
      # Target matches by node.name (present on ALSA sink nodes) rather
      # than api.alsa.card.name (which only exists on device objects).
      filter.smart = true
      filter.smart.name = "scuf-gain-boost"
      filter.smart.target = {
        node.name = "~alsa_output.usb-Scuf_Gaming_SCUF_Envision_Pro*"
      }
      filter.graph = {
        nodes = [
          {
            type = builtin
            name = eq_left
            label = param_eq
            config = {
              filters = [
                { type = bq_highshelf, freq = 0, gain = 12.0, q = 1.0 }
              ]
            }
          }
          {
            type = builtin
            name = eq_right
            label = param_eq
            config = {
              filters = [
                { type = bq_highshelf, freq = 0, gain = 12.0, q = 1.0 }
              ]
            }
          }
        ]
        links = []
        inputs = [ "eq_left:In" "eq_right:In" ]
        outputs = [ "eq_left:Out" "eq_right:Out" ]
      }
      audio.channels = 2
      audio.position = [ FL FR ]
      capture.props = {
        node.name = "effect_input.scuf_gain"
        media.class = Audio/Sink
      }
      playback.props = {
        node.name = "effect_output.scuf_gain"
        node.passive = true
      }
    }
  }
]
