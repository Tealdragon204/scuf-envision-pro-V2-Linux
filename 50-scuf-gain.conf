# SCUF Envision Pro V2 â€” Gain boost for quiet headphone output
#
# The SCUF's hardware mixer maxes out at -16 dB, making audio much
# quieter than expected even at 100% software volume.
#
# This config uses WirePlumber's Software DSP mechanism to transparently
# apply a +12 dB gain boost on the SCUF output sink. When the SCUF is
# connected, WirePlumber creates a virtual sink with gain processing
# that routes audio to the real hardware sink.
#
# Only targets audio OUTPUT (alsa_output.*), not the microphone input.
#
# Adjust the "Gain" value below if audio is too loud or too quiet:
#   +6 dB  = ~2x louder    (conservative)
#   +12 dB = ~4x louder    (recommended default)
#   +16 dB = ~6x louder    (fully compensates hardware -16 dB deficit)
#   +18 dB = ~8x louder    (risk of clipping on loud content)
#
# Install: sudo cp 50-scuf-gain.conf /etc/wireplumber/wireplumber.conf.d/
#          (same directory as 50-scuf-audio.conf)
# Then restart PipeWire/WirePlumber or reboot.
#
# Requires WirePlumber 0.5.7+ (node.software-dsp feature).
# The 'optional' profile entry ensures WirePlumber still starts if the
# feature is unavailable on older versions.

wireplumber.profiles = {
  main = {
    node.software-dsp = optional
  }
}

node.software-dsp.rules = [
  {
    matches = [
      {
        node.name = "~alsa_output.usb-Scuf_Gaming_SCUF_Envision_Pro*"
      }
    ]
    actions = {
      create-filter = {
        filter-graph = {
          node.description = "SCUF Gain Boost"
          media.name       = "SCUF Gain Boost"
          filter.graph = {
            nodes = [
              {
                type    = builtin
                name    = gain
                label   = bq_highshelf
                control = { "Freq" = 0.0, "Q" = 1.0, "Gain" = 12.0 }
              }
            ]
          }
          audio.channels = 2
          audio.position = [ FL, FR ]
          capture.props = {
            media.class = Audio/Sink
          }
          playback.props = {
            node.passive = true
            media.role   = "DSP"
          }
        }
        hide-parent = false
      }
    }
  }
]
